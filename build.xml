<project name="MooreaLabBench" default="dist" basedir=".">

   <import file="../build.xml"/>


   <property file="plugin.properties"/>
   <property name="plugin-name" value="com.biomatters.plugins.biocode.BiocodePlugin"/>
   <property name="classes" location="bin"/>
   <property name="lib" location="lib"/>
   <property name="resources" location="resources"/>
   <property name="src" location="src"/>


   <path id="classpath">
      <fileset dir="${lib}"/>
      <path refid="classpath.privateapi"/>
   </path>

   <path id="classpath.test.local">
      <path refid="classpath"/>
      <path refid="classpath.test"/>
      <pathelement location="bin"/>
      <pathelement location="testdata"/>
   </path>

   <target name="dist">
      <zip zipfile="${dist}/${short-plugin-name}.gplugin">
         <fileset dir="${build.externalPlugins}/${plugin-name}"/>
      </zip>
   </target>

   <target name="install-for-test" depends="build">
      <move file="${build.externalPlugins}/${plugin-name}/${plugin-name}" todir="${build.plugins}"/>
   </target>

   <target name="build">
      <jar jarfile="${build.externalPlugins}/${plugin-name}/${plugin-name}/${short-plugin-name}.jar">
         <fileset dir="${classes}"/>
         <fileset dir="${resources}">
            <exclude name="plugin.properties"/>
         </fileset>
      </jar>
      <copy todir="${build.externalPlugins}/${plugin-name}/${plugin-name}" flatten="true">
         <fileset dir="${lib}" excludes="fusiotables/*-sources.jar fusiotables/*-javadoc.jar" />
         <fileset dir="">
            <include name="plugin.properties"/>
         </fileset>
         <fileset dir="doc">
             <include name="readme.html"/>
         </fileset>
      </copy>
      <echo file="${plugins.proguard}" append="true"
            message="-injars ${build.externalPlugins}/${plugin-name}/${plugin-name}/${short-plugin-name}.jar${line.separator}"/>
      <echo file="${plugins.proguard}" append="true"
            message="-outjars ${build.externalPlugins}/${plugin-name}/${plugin-name}/${short-plugin-name}-obfuscated.jar${line.separator}"/>


       <!--
       <echo file="${plugins.proguard}" append="true"
            message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}(!${short-plugin-name}.jar,*.jar)${line.separator}" />
       -->
       <!--<echo file="${plugins.proguard}" append="true"-->
            <!--message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/gdata-core-1.0.jar${line.separator}"/>-->
       <!--<echo file="${plugins.proguard}" append="true"-->
            <!--message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/google-collect-1.0.jar${line.separator}"/>-->
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/hsqldb.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
            message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/jai_core.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/jai_codec.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/jcommon-1.0.16.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
            message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/jfreechart-1.0.13.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/jxl.jar${line.separator}"/>

       <!--FUSION TABLE LIBRARIES-->
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/commons-logging-1.1.1.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/google-api-client-1.12.0-beta.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/google-api-services-fusiontables-v1-rev12-1.12.0-beta.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/google-http-client-1.12.0-beta.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/google-http-client-gson-1.12.0-beta.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/google-oauth-client-1.12.0-beta.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/google-oauth-client-java6-1.12.0-beta.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/google-oauth-client-jetty-1.12.0-beta.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/gson-2.1.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/guava-jdk5-13.0.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/httpclient-4.0.3.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/httpcore-4.0.1.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/javaee.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/jetty-6.1.26.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/jetty-util-6.1.26.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/jsr305-1.3.9.jar${line.separator}"/>
       <echo file="${plugins.proguard}" append="true"
                   message="-libraryjars   ${build.externalPlugins}/${plugin-name}/${plugin-name}/xpp3-1.1.4c.jar${line.separator}"/>
   </target>

   <target name="compile" depends="prepare">
      <javac target="1.5" destdir="${classes}" debug="true">
         <classpath refid="classpath"/>
         <src path="src"/>
      </javac>
      <javac target="1.5" destdir="${classes.test}" debug="${debug}">
         <classpath refid="classpath.test.local"/>
         <src path="test"/>
      </javac>
      <copy todir="${classes.test}" failonerror="false">
         <fileset dir="testdata"/>
      </copy>
   </target>

   <target name="prepare" depends="clean">
      <mkdir dir="${build.externalPlugins}/${plugin-name}/${plugin-name}"/>
      <mkdir dir="${classes}"/>
   </target>

   <target name="clean">
      <delete dir="${build.externalPlugins}/${plugin-name}"/>
      <delete dir="${classes}"/>
      <delete  file="${dist}/${short-plugin-name}.gplugin"/>
   </target>
</project>
