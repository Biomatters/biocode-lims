<project name="MooreaLabBench" default="dist" basedir=".">

   <import file="../build.xml"/>

<!--   <property name="build-for-current" value="COMMENT THIS PROPERTY OUT to exclude from test-currentRelease"/> -->
   <property file="plugin.properties"/>
   <property name="plugin.name" value="com.biomatters.plugins.moorea.MooreaPlugin"/>
   <property name="plugin-build" location="build"/>
   <property name="classes" location="bin"/>
   <property name="lib" location="lib"/>
   <property name="resources" location="resources"/>
   <property name="src" location="src"/>


   <path id="classpath">
      <fileset dir="${lib}"/>
      <path refid="classpath.publicapi"/>
   </path>

   <path id="classpath.test.local">
      <path refid="classpath"/>
      <path refid="classpath.test"/>
      <pathelement location="bin"/>
      <pathelement location="testdata"/>
   </path>

   <target name="dist" depends="build">
      <zip zipfile="${dist}/${short-plugin-name}.gplugin">
         <fileset dir="${plugin-build}"/>
      </zip>
   </target>

   <!--<target name= "dist" depends="build">-->
      <!--<copy file="${plugin-build}/${plugin.name}.jar"-->
            <!--tofile="${dist}/${short-plugin-name}.gplugin"/>-->
   <!--</target>-->

   <target name="install-for-test" depends="build">
      <move file="${plugin-build}/${plugin.name}" todir="${build.plugins}"/>
   </target>

   <target name="build" depends="compile">
      <jar jarfile="${plugin-build}/${plugin-name}/${short-plugin-name}.jar">
         <fileset dir="${classes}"/>
         <fileset dir="${resources}">
            <include name="plugin.properties"/>
         </fileset>
      </jar>
      <copy todir="${plugin-build}/${plugin-name}">
         <fileset dir="${lib}"/>
         <fileset dir="${resources}">
            <exclude name="plugin.properties"/>
         </fileset>
      </copy>
   </target>

   <!--<target name="build" depends="compile">-->
      <!--<jar jarfile="${plugin-build}/${plugin.name}.jar">-->
         <!--<fileset dir="${classes}"/>-->
         <!--<fileset dir="${resources}"/>-->
         <!--<fileset dir="${lib}"/>-->
         <!--<fileset dir="">-->
            <!--<include name="plugin.properties"/>-->
         <!--</fileset>-->
      <!--</jar>-->
   <!--</target>-->

   <target name="compile" depends="build-public-api, prepare">
      <javac destdir="${classes}" debug="true">
         <classpath refid="classpath"/>
         <src path="src"/>
      </javac>
      <javac destdir="${classes.test}" debug="${debug}">
         <classpath refid="classpath.test.local"/>
         <src path="test"/>
      </javac>
      <copy todir="${classes.test}" failonerror="false">
         <fileset dir="testdata"/>
      </copy>
   </target>

   <target name="prepare">
      <mkdir dir="${plugin-build}/${plugin-name}"/>
      <mkdir dir="${classes}"/>
   </target>

   <target name="clean">
      <delete dir="${plugin-build}"/>
      <delete dir="${classes}"/>
   </target>
</project>
